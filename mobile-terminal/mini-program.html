<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>微信小程序 | Ryan Lin 的知识库</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.731cac2c.css" as="style"><link rel="preload" href="/assets/js/app.73a83186.js" as="script"><link rel="preload" href="/assets/js/2.bffc4eaa.js" as="script"><link rel="preload" href="/assets/js/83.127f9df0.js" as="script"><link rel="prefetch" href="/assets/js/10.38cc8590.js"><link rel="prefetch" href="/assets/js/100.5616c72f.js"><link rel="prefetch" href="/assets/js/101.5e2ec8a1.js"><link rel="prefetch" href="/assets/js/102.6e5a1bf2.js"><link rel="prefetch" href="/assets/js/103.398a435a.js"><link rel="prefetch" href="/assets/js/104.c7e641cc.js"><link rel="prefetch" href="/assets/js/105.e67c3fa2.js"><link rel="prefetch" href="/assets/js/106.00630c3f.js"><link rel="prefetch" href="/assets/js/107.6f853248.js"><link rel="prefetch" href="/assets/js/108.98824210.js"><link rel="prefetch" href="/assets/js/109.fe238d24.js"><link rel="prefetch" href="/assets/js/11.a2dca14a.js"><link rel="prefetch" href="/assets/js/110.1835783c.js"><link rel="prefetch" href="/assets/js/111.89776df2.js"><link rel="prefetch" href="/assets/js/112.b776386e.js"><link rel="prefetch" href="/assets/js/113.b13ed41a.js"><link rel="prefetch" href="/assets/js/114.46d4ef7b.js"><link rel="prefetch" href="/assets/js/115.fa7306e4.js"><link rel="prefetch" href="/assets/js/116.61af7abc.js"><link rel="prefetch" href="/assets/js/117.ec0af3a6.js"><link rel="prefetch" href="/assets/js/118.6d40254d.js"><link rel="prefetch" href="/assets/js/119.a1d4690f.js"><link rel="prefetch" href="/assets/js/12.7ee44e05.js"><link rel="prefetch" href="/assets/js/120.6d1b8225.js"><link rel="prefetch" href="/assets/js/121.3ebd0128.js"><link rel="prefetch" href="/assets/js/122.b96c7eb6.js"><link rel="prefetch" href="/assets/js/123.d89a8d05.js"><link rel="prefetch" href="/assets/js/124.ded284b7.js"><link rel="prefetch" href="/assets/js/125.349c5f1b.js"><link rel="prefetch" href="/assets/js/126.0a49d917.js"><link rel="prefetch" href="/assets/js/127.2f3aaaa8.js"><link rel="prefetch" href="/assets/js/128.99766c05.js"><link rel="prefetch" href="/assets/js/129.9e1f6ddd.js"><link rel="prefetch" href="/assets/js/13.d312827d.js"><link rel="prefetch" href="/assets/js/130.6cae6c2a.js"><link rel="prefetch" href="/assets/js/131.c7575f44.js"><link rel="prefetch" href="/assets/js/132.7e8912d7.js"><link rel="prefetch" href="/assets/js/133.4135f111.js"><link rel="prefetch" href="/assets/js/134.c55a2fa2.js"><link rel="prefetch" href="/assets/js/135.b4da1443.js"><link rel="prefetch" href="/assets/js/136.0981e35a.js"><link rel="prefetch" href="/assets/js/137.20ad4181.js"><link rel="prefetch" href="/assets/js/138.9be9d6ed.js"><link rel="prefetch" href="/assets/js/139.5b05b960.js"><link rel="prefetch" href="/assets/js/14.5492294e.js"><link rel="prefetch" href="/assets/js/140.e609a093.js"><link rel="prefetch" href="/assets/js/141.a34faff7.js"><link rel="prefetch" href="/assets/js/142.f6bda4fc.js"><link rel="prefetch" href="/assets/js/143.ff5ba6ad.js"><link rel="prefetch" href="/assets/js/144.f6ddfce6.js"><link rel="prefetch" href="/assets/js/145.08ee0900.js"><link rel="prefetch" href="/assets/js/146.75aacfa8.js"><link rel="prefetch" href="/assets/js/147.fb54b3ce.js"><link rel="prefetch" href="/assets/js/148.64b5c547.js"><link rel="prefetch" href="/assets/js/149.d160adf4.js"><link rel="prefetch" href="/assets/js/15.e9cba34b.js"><link rel="prefetch" href="/assets/js/150.e669b46c.js"><link rel="prefetch" href="/assets/js/151.c6156c79.js"><link rel="prefetch" href="/assets/js/152.a8a2ba4f.js"><link rel="prefetch" href="/assets/js/153.2fffca67.js"><link rel="prefetch" href="/assets/js/154.79832011.js"><link rel="prefetch" href="/assets/js/155.9159e076.js"><link rel="prefetch" href="/assets/js/156.33fa2b93.js"><link rel="prefetch" href="/assets/js/157.64c4f0de.js"><link rel="prefetch" href="/assets/js/158.e3b5dbd5.js"><link rel="prefetch" href="/assets/js/159.d3bd4405.js"><link rel="prefetch" href="/assets/js/16.a566ed64.js"><link rel="prefetch" href="/assets/js/160.5896422c.js"><link rel="prefetch" href="/assets/js/161.51b51445.js"><link rel="prefetch" href="/assets/js/162.dae54667.js"><link rel="prefetch" href="/assets/js/17.007b11a9.js"><link rel="prefetch" href="/assets/js/18.433067ce.js"><link rel="prefetch" href="/assets/js/19.86942a74.js"><link rel="prefetch" href="/assets/js/20.ba24429b.js"><link rel="prefetch" href="/assets/js/21.9ef0a911.js"><link rel="prefetch" href="/assets/js/22.e7986fa5.js"><link rel="prefetch" href="/assets/js/23.0ee1af7d.js"><link rel="prefetch" href="/assets/js/24.173ae07d.js"><link rel="prefetch" href="/assets/js/25.44b2bbcf.js"><link rel="prefetch" href="/assets/js/26.7927e873.js"><link rel="prefetch" href="/assets/js/27.04db8335.js"><link rel="prefetch" href="/assets/js/28.5c4dfcef.js"><link rel="prefetch" href="/assets/js/29.04015338.js"><link rel="prefetch" href="/assets/js/3.c8164ecf.js"><link rel="prefetch" href="/assets/js/30.fc56450c.js"><link rel="prefetch" href="/assets/js/31.8fb58c49.js"><link rel="prefetch" href="/assets/js/32.8bb94133.js"><link rel="prefetch" href="/assets/js/33.575977b7.js"><link rel="prefetch" href="/assets/js/34.fd078996.js"><link rel="prefetch" href="/assets/js/35.92513fa4.js"><link rel="prefetch" href="/assets/js/36.9b74b253.js"><link rel="prefetch" href="/assets/js/37.7258af7d.js"><link rel="prefetch" href="/assets/js/38.22e87e0e.js"><link rel="prefetch" href="/assets/js/39.aa2bbf3c.js"><link rel="prefetch" href="/assets/js/4.9f8ced62.js"><link rel="prefetch" href="/assets/js/40.716dc647.js"><link rel="prefetch" href="/assets/js/41.b7c3b7a2.js"><link rel="prefetch" href="/assets/js/42.91620300.js"><link rel="prefetch" href="/assets/js/43.0c1fe267.js"><link rel="prefetch" href="/assets/js/44.217852c0.js"><link rel="prefetch" href="/assets/js/45.2ac5f591.js"><link rel="prefetch" href="/assets/js/46.b6f13dd8.js"><link rel="prefetch" href="/assets/js/47.e9debbea.js"><link rel="prefetch" href="/assets/js/48.ea1a970a.js"><link rel="prefetch" href="/assets/js/49.7e0051b7.js"><link rel="prefetch" href="/assets/js/5.56f50984.js"><link rel="prefetch" href="/assets/js/50.19a20ef2.js"><link rel="prefetch" href="/assets/js/51.b048feeb.js"><link rel="prefetch" href="/assets/js/52.3217428f.js"><link rel="prefetch" href="/assets/js/53.69555214.js"><link rel="prefetch" href="/assets/js/54.602e3c97.js"><link rel="prefetch" href="/assets/js/55.6b4a40ce.js"><link rel="prefetch" href="/assets/js/56.3bede644.js"><link rel="prefetch" href="/assets/js/57.19f08efb.js"><link rel="prefetch" href="/assets/js/58.8c954335.js"><link rel="prefetch" href="/assets/js/59.b1dba70f.js"><link rel="prefetch" href="/assets/js/6.e9b450da.js"><link rel="prefetch" href="/assets/js/60.250f9b60.js"><link rel="prefetch" href="/assets/js/61.4750d481.js"><link rel="prefetch" href="/assets/js/62.f70cf17e.js"><link rel="prefetch" href="/assets/js/63.d6ee5ff2.js"><link rel="prefetch" href="/assets/js/64.80eb8689.js"><link rel="prefetch" href="/assets/js/65.b2cccd02.js"><link rel="prefetch" href="/assets/js/66.6f9eb51a.js"><link rel="prefetch" href="/assets/js/67.18fd06d8.js"><link rel="prefetch" href="/assets/js/68.bdbfb24c.js"><link rel="prefetch" href="/assets/js/69.6def8ae5.js"><link rel="prefetch" href="/assets/js/7.e06d5bee.js"><link rel="prefetch" href="/assets/js/70.683cbb6d.js"><link rel="prefetch" href="/assets/js/71.60f13cc5.js"><link rel="prefetch" href="/assets/js/72.538df216.js"><link rel="prefetch" href="/assets/js/73.8352279e.js"><link rel="prefetch" href="/assets/js/74.1cc346c3.js"><link rel="prefetch" href="/assets/js/75.5ce4f41c.js"><link rel="prefetch" href="/assets/js/76.60929b1f.js"><link rel="prefetch" href="/assets/js/77.4a288f1c.js"><link rel="prefetch" href="/assets/js/78.4cdf0ea7.js"><link rel="prefetch" href="/assets/js/79.cc92a391.js"><link rel="prefetch" href="/assets/js/8.0c82c132.js"><link rel="prefetch" href="/assets/js/80.e05e720e.js"><link rel="prefetch" href="/assets/js/81.755dbe10.js"><link rel="prefetch" href="/assets/js/82.d19b52ca.js"><link rel="prefetch" href="/assets/js/84.a163cb12.js"><link rel="prefetch" href="/assets/js/85.74771988.js"><link rel="prefetch" href="/assets/js/86.74eea1f0.js"><link rel="prefetch" href="/assets/js/87.2d3bde0d.js"><link rel="prefetch" href="/assets/js/88.fe9fc8f4.js"><link rel="prefetch" href="/assets/js/89.95d1839d.js"><link rel="prefetch" href="/assets/js/9.81357d9e.js"><link rel="prefetch" href="/assets/js/90.10f7ef36.js"><link rel="prefetch" href="/assets/js/91.17f623ed.js"><link rel="prefetch" href="/assets/js/92.5cdc42eb.js"><link rel="prefetch" href="/assets/js/93.18be408d.js"><link rel="prefetch" href="/assets/js/94.9721f213.js"><link rel="prefetch" href="/assets/js/95.f8bec4ea.js"><link rel="prefetch" href="/assets/js/96.5f1693b3.js"><link rel="prefetch" href="/assets/js/97.9a3a98ee.js"><link rel="prefetch" href="/assets/js/98.ebd2b458.js"><link rel="prefetch" href="/assets/js/99.fd24ebc6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.731cac2c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.jpg" alt="Ryan Lin 的知识库" class="logo"> <span class="site-name can-hide">Ryan Lin 的知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Typescript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NodeJs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>同构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>serverless</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>移动端</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mobile-terminal/overview.html" class="sidebar-link">概览</a></li><li><a href="/mobile-terminal/offline-package.html" class="sidebar-link">离线包</a></li><li><a href="/mobile-terminal/mini-program.html" aria-current="page" class="active sidebar-link">微信小程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#由来" class="sidebar-link">由来</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#通信" class="sidebar-link">通信</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#运行机制" class="sidebar-link">运行机制</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#支付流程" class="sidebar-link">支付流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#详细流程" class="sidebar-link">详细流程</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#支付安全" class="sidebar-link">支付安全</a></li></ul></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#优化速度" class="sidebar-link">优化速度</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#加载优化" class="sidebar-link">加载优化</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#渲染优化" class="sidebar-link">渲染优化</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#首屏优化" class="sidebar-link">首屏优化</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#启动优化" class="sidebar-link">启动优化</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#长列表优化" class="sidebar-link">长列表优化</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#打包策略" class="sidebar-link">打包策略</a></li></ul></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#路由跳转" class="sidebar-link">路由跳转</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#wx-navigateto" class="sidebar-link">wx.navigateTo</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#wx-redirectto" class="sidebar-link">wx.redirectTo</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#wx-navigateback" class="sidebar-link">wx.navigateBack</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#wx-relaunch" class="sidebar-link">wx.reLaunch</a></li></ul></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#登录" class="sidebar-link">登录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#获取code" class="sidebar-link">获取code</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#获取openid" class="sidebar-link">获取openid</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#校验openid" class="sidebar-link">校验openid</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#返回登录态" class="sidebar-link">返回登录态</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#校验登录态" class="sidebar-link">校验登录态</a></li></ul></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#生命周期" class="sidebar-link">生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#应用生命周期" class="sidebar-link">应用生命周期</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#页面生命周期" class="sidebar-link">页面生命周期</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#组件生命周期" class="sidebar-link">组件生命周期</a></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#执行顺序" class="sidebar-link">执行顺序</a></li></ul></li><li class="sidebar-sub-header"><a href="/mobile-terminal/mini-program.html#优缺点" class="sidebar-link">优缺点</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>桌面端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Monorepo</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Chrome</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>引擎</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DevOps</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>流程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>灰度</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>监控</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>部署</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>发布</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/design-patterns/origin" class="sidebar-heading clickable"><span>设计模式</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构与算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>调试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>测试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>文档管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>编程范式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>C++</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中国近代史纲要</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>马克思主义基本原理概述</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="微信小程序"><a href="#微信小程序" class="header-anchor">#</a> 微信小程序</h1> <h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>在传统的网页开发中，渲染线程和脚本是互斥的，这也是为什么长时间的脚本运行可能会导致页面失去响应的原因，因为我们常说的 JS 是单线程的。而微信小程序则选用了 Hybrid 的渲染方式，将视图层和逻辑层分开，实现双线程同时运行。在此模式下，视图层的界面使用 WebView 进行渲染，而逻辑层则在 JSCore 中运行。</p> <p><img src="/assets/img/mini-program/architecture.png" alt="alt 属性文本"></p> <p>在小程序中，渲染层主要负责界面渲染相关的任务，并在 WebView 线程里执行。一个小程序可能存在多个界面，所以渲染层存在多个 WebView 线程。而逻辑层则采用 JsCore 线程运行 JS 脚本，执行的都是与小程序业务逻辑有关的代码。</p> <h2 id="由来"><a href="#由来" class="header-anchor">#</a> 由来</h2> <p>当微信中的WebView逐渐成为移动Web的一个重要入口时,微信就有相关的JS-SDK。JS-SDK解决了移动网页能力不足的问题,但没有解决体验不良的问题。</p> <p>为此,小程序应运而生,具有:</p> <ul><li>快速加载</li> <li>更强大的能力</li> <li>原生体验</li> <li>易用的微信数据开放</li> <li>高效简单的开发</li></ul> <p>小程序页面本质上是网页,技术模型与H5类似,只是自定义了WXML标签。</p> <h2 id="通信"><a href="#通信" class="header-anchor">#</a> 通信</h2> <p>在小程序的渲染层，宿主环境会将wxml转化成对应的JS对象。当逻辑层的数据发生变更时，通过宿主环境提供的setData方法，数据就可以从逻辑层传递到渲染层。然后通过对比数据变化前后的差异，将差异应用在原来的Dom树上，从而渲染出正确的视图。</p> <p><img src="/assets/img/mini-program/dom-mounte.png" alt="alt 属性文本"></p> <p>由于小程序是基于双线程的，因此在视图层和逻辑层之间的任何数据传递都是线程间的通信，会有一定的延时。所以在小程序中，页面更新成了异步操作。异步会使得各部分的运行时序变得复杂一些，逻辑层与渲染层需要有一定的机制保证时序正确，在每个小程序页面的生命周期中，存在着若干次页面数据通信。</p> <p><img src="/assets/img/mini-program/patch.png" alt="alt 属性文本"></p> <h2 id="运行机制"><a href="#运行机制" class="header-anchor">#</a> 运行机制</h2> <p>小程序启动运行主要有两种情况：</p> <ul><li>冷启动（重新开始）：用户首次打开或者小程序被微信主动销毁后再次打开的情况，此时小程序需要重新加载启动，即为冷启动</li> <li>热启动：用户已经打开过小程序，然后在一定时间内再次打开该小程序，此时无需重新启动，只需要将后台态的小程序切换到前台，这个过程就是热启动</li></ul> <p>需要注意的是：</p> <ul><li>小程序没有重启的概念</li> <li>当小程序进入后台，客户端会维持一段时间的运行状态，超过一定时间后会被微信主动销毁</li> <li>短时间内收到系统两次以上内存警告，也会对小程序进行销毁，这也就为什么一旦页面内存溢出，页面会奔溃的本质原因了</li></ul> <p><img src="/assets/img/mini-program/load.png" alt="alt 属性文本"></p> <h2 id="支付流程"><a href="#支付流程" class="header-anchor">#</a> 支付流程</h2> <p>流程大致如下：</p> <ul><li>用户通过分享或扫描二维码进入商户小程序，用户选择购买，完成选购流程。</li> <li>调起微信支付控件，用户开始输入支付密码。</li> <li>密码验证通过，支付成功。商户后台得到支付成功的通知。</li> <li>返回商户小程序，显示购买成功。</li> <li>微信支付公众号下发支付凭证。</li></ul> <p><img src="/assets/img/mini-program/pay-overview.png" alt="alt 属性文本"></p> <h3 id="详细流程"><a href="#详细流程" class="header-anchor">#</a> 详细流程</h3> <p>以电商小程序为例，支付流程图如下：</p> <p><img src="/assets/img/mini-program/pay-flow.png" alt="alt 属性文本"></p> <p>具体操作流程如下：</p> <ul><li>打开小程序，点击直接下单。此时，小程序会调用wx.login获取用户临时登录凭证code，然后发送到后端服务器换取openId。</li> <li>用户下单，小程序需要将购买的商品Id，商品数量，以及用户的openId传送到服务器。</li> <li>服务器在接收到商品Id、商品数量、openId后，生成订单数据。同时，通过签名算法，向微信支付发送请求，获取预付单信息（prepay_id）。然后，服务器会将获取的数据再次进行签名，向小程序端响应必要的信息。</li> <li>小程序端在获取对应的参数后，调用wx.requestPayment()发起微信支付，唤醒支付工作台，进行支付。</li> <li>接下来，用户会进行微信支付密码、指纹等验证。确认支付之后，微信后台进行鉴权，直接返回给前端支付的结果。前端收到返回数据后对支付结果进行展示。</li> <li>最后，微信后台在给前端返回支付的结果后，也会向后台返回一个支付结果。后台通过这个支付结果来更新订单的状态。</li></ul> <p>以下是后端响应数据和wx.requestPayment方法所需要的参数示例：</p> <div class="language-wx line-numbers-mode"><pre class="language-text"><code>wx.requestPayment({
  // 时间戳
  timeStamp: '',
  // 随机字符串
  nonceStr: '',
  // 统一下单接口返回的 prepay_id 参数值
  package: '',
  // 签名类型
  signType: '',
  // 签名
  paySign: '',
  // 调用成功回调
  success () {},
  // 失败回调
  fail () {},
  // 接口调用结束回调
  complete () {}
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>参数表如下所示：</p> <p><img src="/assets/img/mini-program/pay-params.webp" alt="alt 属性文本"></p> <h3 id="支付安全"><a href="#支付安全" class="header-anchor">#</a> 支付安全</h3> <p>对于支付的安全，微信小程序采用了多重安全措施。</p> <ul><li><p>首先，微信支付是基于HTTPS传输加密数据，采用安全协议来保证信息传输的安全性。</p></li> <li><p>其次，微信支付服务提供了商户证书下发、报文签名以及商户数据包（MD5）校验等多种安全机制来防止信息被篡改。</p></li> <li><p>此外，用户的支付信息如银行卡号、密码、验证码等信息均不会保存在商户系统或者微信系统，即使在微信服务器被攻破，也无法获取用户的真实支付信息。</p></li> <li><p>最后，微信支付还为用户提供了交易过程中的安全保障，通过多种风险控制系统为用户拦截可疑交易。</p></li></ul> <h2 id="优化速度"><a href="#优化速度" class="header-anchor">#</a> 优化速度</h2> <h3 id="加载优化"><a href="#加载优化" class="header-anchor">#</a> 加载优化</h3> <ul><li>控制代码包体积,及时清理无用代码</li> <li>使用子包按需加载,减少主包体积</li> <li>预加载子包,避免首次点击卡顿</li></ul> <h3 id="渲染优化"><a href="#渲染优化" class="header-anchor">#</a> 渲染优化</h3> <ul><li>onLoad阶段发请求,不等待onReady</li> <li>缓存本地数据,减少不必要的网络请求</li> <li>合并setData调用,避免频繁刷新界面</li> <li>抽离自定义组件,减少主界面渲染压力</li></ul> <h3 id="首屏优化"><a href="#首屏优化" class="header-anchor">#</a> 首屏优化</h3> <ul><li>预请求数据,利用缓存数据构建首屏</li> <li>采用骨架屏 placeholders 占位</li> <li>提前预加载资源包</li></ul> <h3 id="启动优化"><a href="#启动优化" class="header-anchor">#</a> 启动优化</h3> <ul><li>显示加载图标避免白屏</li> <li>合理制定启动图片大小</li></ul> <h3 id="长列表优化"><a href="#长列表优化" class="header-anchor">#</a> 长列表优化</h3> <ul><li>虚拟列表,减少DOM节点</li> <li>预加载可视区域外图片</li> <li>图片懒加载,滚动到可视区再加载</li></ul> <h3 id="打包策略"><a href="#打包策略" class="header-anchor">#</a> 打包策略</h3> <ul><li>压缩代码,上传时启用代码压缩</li> <li>按功能拆分子包</li> <li>删除无用文件,精简资源体积</li></ul> <h2 id="路由跳转"><a href="#路由跳转" class="header-anchor">#</a> 路由跳转</h2> <h3 id="wx-navigateto"><a href="#wx-navigateto" class="header-anchor">#</a> wx.navigateTo</h3> <p>保留当前页面,跳转到应用内的某个页面。可以使用wx.navigateBack回到原页面。</p> <p>特点:页面栈增多,占用内存。</p> <p>参数:</p> <div class="language-wx line-numbers-mode"><pre class="language-text"><code>{
  url: 'test?id=1' // 需要跳转的应用内非 tabBar 的页面的路径
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="wx-redirectto"><a href="#wx-redirectto" class="header-anchor">#</a> wx.redirectTo</h3> <p>关闭当前页面,跳转到应用内的某个页面。</p> <p>特点:不能回到原页面,页面栈不增加。</p> <p>参数:</p> <div class="language-wx line-numbers-mode"><pre class="language-text"><code>{
  url: 'test?id=1' // 需要跳转的应用内非 tabBar 的页面的路径
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="wx-navigateback"><a href="#wx-navigateback" class="header-anchor">#</a> wx.navigateBack</h3> <p>关闭当前页面,返回上一页面或多级页面。</p> <p>特点:页面栈逐级退出,减少内存占用。</p> <p>参数:</p> <div class="language-wx line-numbers-mode"><pre class="language-text"><code>{
  delta: 1 // 返回的页面数
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="wx-relaunch"><a href="#wx-relaunch" class="header-anchor">#</a> wx.reLaunch</h3> <p>关闭所有页面,打开到应用内的某个页面。</p> <p>特点:页面栈清空只留下新的页面。</p> <p>参数:</p> <div class="language-wx line-numbers-mode"><pre class="language-text"><code>{
  url: 'test' // 需要跳转的页面路径 
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="登录"><a href="#登录" class="header-anchor">#</a> 登录</h2> <h3 id="获取code"><a href="#获取code" class="header-anchor">#</a> 获取code</h3> <ul><li><p>用户在小程序内点击登录按钮</p></li> <li><p>调用wx.login()获取code</p></li></ul> <h3 id="获取openid"><a href="#获取openid" class="header-anchor">#</a> 获取openid</h3> <ul><li><p>将code发送到开发者服务器</p></li> <li><p>开发者服务器使用code向微信服务器获取openid和session_key</p></li></ul> <h3 id="校验openid"><a href="#校验openid" class="header-anchor">#</a> 校验openid</h3> <ul><li><p>开发者服务器拿到openid,去数据库查询是否已存在</p></li> <li><p>若不存在,表示新用户,创建新记录</p></li> <li><p>若存在,校验用户信息,生成自定义登录态</p></li></ul> <h3 id="返回登录态"><a href="#返回登录态" class="header-anchor">#</a> 返回登录态</h3> <ul><li><p>开发者服务器将登录态返回给小程序</p></li> <li><p>小程序存储登录态到本地</p></li></ul> <h3 id="校验登录态"><a href="#校验登录态" class="header-anchor">#</a> 校验登录态</h3> <ul><li><p>小程序重新启动时可校验登录态</p></li> <li><p>调用wx.checkSessionAPI验证登录态是否过期</p></li> <li><p>过期则重新执行登录流程,未过期则继续使用</p></li></ul> <p><img src="/assets/img/mini-program/login.png" alt="alt 属性文本"></p> <h2 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h2> <h3 id="应用生命周期"><a href="#应用生命周期" class="header-anchor">#</a> 应用生命周期</h3> <p>应用生命周期函数定义在app.js中</p> <ul><li>onLaunch	小程序初始化完成时触发(全局只触发一次)</li> <li>onShow	小程序启动,或从后台进入前台显示时触发</li> <li>onHide	小程序从前台进入后台时触发</li> <li>onError	小程序发生脚本错误或API调用报错时触发</li> <li>onPageNotFound	小程序要打开的页面不存在时触发</li> <li>onUnhandledRejection	小程序有未处理的Promise拒绝时触发</li> <li>onThemeChange	系统切换主题时触发</li></ul> <h3 id="页面生命周期"><a href="#页面生命周期" class="header-anchor">#</a> 页面生命周期</h3> <p>页面生命周期函数在page.js中定义。</p> <ul><li>onLoad	页面加载时触发	用于加载页面数据</li> <li>onShow	页面显示时触发	页面重新显示时刷新数据</li> <li>onReady	页面初次渲染完成时触发	获取页面 DOM 节点</li> <li>onHide	页面隐藏时触发	停止页面动画或计时器等</li> <li>onUnload	页面卸载时触发	停止网络请求或清理订阅等</li></ul> <h3 id="组件生命周期"><a href="#组件生命周期" class="header-anchor">#</a> 组件生命周期</h3> <p>组件生命周期函数在component.js中定义。</p> <ul><li>created	组件实例刚创建时触发</li> <li>attached	组件进入页面节点树时触发</li> <li>ready	组件首次渲染完成时触发</li> <li>moved	组件位置改变时触发</li> <li>detached	组件离开页面节点树时触发</li> <li>error	组件方法错误时触发</li></ul> <h3 id="执行顺序"><a href="#执行顺序" class="header-anchor">#</a> 执行顺序</h3> <p>一个典型的完整生命周期顺序为:</p> <ul><li><p>小程序打开:onLaunch -&gt; onShow -&gt; onLoad -&gt; onShow -&gt; onReady</p></li> <li><p>进入新页面:onHide -&gt; onLoad -&gt; onShow -&gt; onReady</p></li> <li><p>返回上一页:onUnload -&gt; onShow</p></li> <li><p>小程序切后台:onHide</p></li> <li><p>小程序重启:onLaunch -&gt; onShow</p></li></ul> <h2 id="优缺点"><a href="#优缺点" class="header-anchor">#</a> 优缺点</h2> <p>优点:</p> <ul><li>随用随走,代替许多APP</li> <li>借助平台流量,易被接受</li> <li>相对安全</li> <li>开发门槛低</li> <li>降低兼容性限制</li></ul> <p>缺点:</p> <ul><li>用户留存率不高</li> <li>体积限制,无法开发大型小程序</li> <li>受限于微信管控,自由度较低</li></ul> <p>微信小程序结合了APP和网页的优点,为用户和开发者带来便利,但也存在自身的限制。以其便捷性为先,逐步优化体验,或可成为移动端一个重要的形式。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/19/2023, 12:11:39 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mobile-terminal/offline-package.html" class="prev">
        离线包
      </a></span> <span class="next"><a href="/desktop/overview.html">
        概览
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.73a83186.js" defer></script><script src="/assets/js/2.bffc4eaa.js" defer></script><script src="/assets/js/83.127f9df0.js" defer></script>
  </body>
</html>
