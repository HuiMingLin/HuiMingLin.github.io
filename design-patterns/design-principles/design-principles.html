<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>设计模式 | Ryan Lin 的知识库</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.e53c6d82.css" as="style"><link rel="preload" href="/assets/js/app.5eb6871a.js" as="script"><link rel="preload" href="/assets/js/2.bffc4eaa.js" as="script"><link rel="preload" href="/assets/js/36.d28870aa.js" as="script"><link rel="prefetch" href="/assets/js/10.870f5dc0.js"><link rel="prefetch" href="/assets/js/100.7b5b4a95.js"><link rel="prefetch" href="/assets/js/101.421b0ac2.js"><link rel="prefetch" href="/assets/js/102.a38980c8.js"><link rel="prefetch" href="/assets/js/103.09e97674.js"><link rel="prefetch" href="/assets/js/104.356e42e1.js"><link rel="prefetch" href="/assets/js/105.811e1ad5.js"><link rel="prefetch" href="/assets/js/106.7cfaa290.js"><link rel="prefetch" href="/assets/js/107.a3fe8ea5.js"><link rel="prefetch" href="/assets/js/108.e2d63d75.js"><link rel="prefetch" href="/assets/js/109.7402c10b.js"><link rel="prefetch" href="/assets/js/11.0db74234.js"><link rel="prefetch" href="/assets/js/110.075aaa9c.js"><link rel="prefetch" href="/assets/js/111.eb0adb42.js"><link rel="prefetch" href="/assets/js/112.0f327158.js"><link rel="prefetch" href="/assets/js/113.089311f1.js"><link rel="prefetch" href="/assets/js/114.7d8b7c9a.js"><link rel="prefetch" href="/assets/js/115.8d50a48b.js"><link rel="prefetch" href="/assets/js/116.cfe881cd.js"><link rel="prefetch" href="/assets/js/117.82d65d4d.js"><link rel="prefetch" href="/assets/js/118.90c61e0d.js"><link rel="prefetch" href="/assets/js/119.8e12d508.js"><link rel="prefetch" href="/assets/js/12.1d3d4ae1.js"><link rel="prefetch" href="/assets/js/120.4ccf2694.js"><link rel="prefetch" href="/assets/js/121.e461f91b.js"><link rel="prefetch" href="/assets/js/122.fd5e613e.js"><link rel="prefetch" href="/assets/js/123.e0c1546c.js"><link rel="prefetch" href="/assets/js/124.e62ad441.js"><link rel="prefetch" href="/assets/js/125.a60c13b4.js"><link rel="prefetch" href="/assets/js/126.9e990ea1.js"><link rel="prefetch" href="/assets/js/127.b54e3b82.js"><link rel="prefetch" href="/assets/js/128.3fb6b56d.js"><link rel="prefetch" href="/assets/js/129.5001dcc2.js"><link rel="prefetch" href="/assets/js/13.80c562df.js"><link rel="prefetch" href="/assets/js/130.0fa988ac.js"><link rel="prefetch" href="/assets/js/131.f7acda68.js"><link rel="prefetch" href="/assets/js/132.d98e0172.js"><link rel="prefetch" href="/assets/js/133.2671ca37.js"><link rel="prefetch" href="/assets/js/134.b5796cf0.js"><link rel="prefetch" href="/assets/js/135.34bef742.js"><link rel="prefetch" href="/assets/js/136.59417f2d.js"><link rel="prefetch" href="/assets/js/137.b67bb20d.js"><link rel="prefetch" href="/assets/js/138.cba3623f.js"><link rel="prefetch" href="/assets/js/139.d7379809.js"><link rel="prefetch" href="/assets/js/14.accbd06a.js"><link rel="prefetch" href="/assets/js/140.5cad6e17.js"><link rel="prefetch" href="/assets/js/141.10687669.js"><link rel="prefetch" href="/assets/js/142.1851e388.js"><link rel="prefetch" href="/assets/js/143.65b5ce9b.js"><link rel="prefetch" href="/assets/js/144.bdaaf5a4.js"><link rel="prefetch" href="/assets/js/145.add89c86.js"><link rel="prefetch" href="/assets/js/146.dcf7f250.js"><link rel="prefetch" href="/assets/js/147.30abbce2.js"><link rel="prefetch" href="/assets/js/148.b19531a0.js"><link rel="prefetch" href="/assets/js/149.560e51a9.js"><link rel="prefetch" href="/assets/js/15.05db5fd6.js"><link rel="prefetch" href="/assets/js/150.6f67fe90.js"><link rel="prefetch" href="/assets/js/151.3b5d8386.js"><link rel="prefetch" href="/assets/js/152.565b70fb.js"><link rel="prefetch" href="/assets/js/153.6b645e98.js"><link rel="prefetch" href="/assets/js/154.92adca73.js"><link rel="prefetch" href="/assets/js/155.fd909e60.js"><link rel="prefetch" href="/assets/js/156.fb0a6005.js"><link rel="prefetch" href="/assets/js/157.ae4d31b5.js"><link rel="prefetch" href="/assets/js/158.97466ee9.js"><link rel="prefetch" href="/assets/js/159.bd67efc5.js"><link rel="prefetch" href="/assets/js/16.0f99f870.js"><link rel="prefetch" href="/assets/js/160.5f1e8eba.js"><link rel="prefetch" href="/assets/js/161.c6b279d8.js"><link rel="prefetch" href="/assets/js/162.2ced747f.js"><link rel="prefetch" href="/assets/js/163.2e925133.js"><link rel="prefetch" href="/assets/js/164.f06af007.js"><link rel="prefetch" href="/assets/js/165.5ca95b73.js"><link rel="prefetch" href="/assets/js/166.3ddb19d3.js"><link rel="prefetch" href="/assets/js/167.14958591.js"><link rel="prefetch" href="/assets/js/168.361fc960.js"><link rel="prefetch" href="/assets/js/169.cbf0929a.js"><link rel="prefetch" href="/assets/js/17.ea4bc1fc.js"><link rel="prefetch" href="/assets/js/170.8d98e721.js"><link rel="prefetch" href="/assets/js/171.9b78f9fc.js"><link rel="prefetch" href="/assets/js/172.64db5933.js"><link rel="prefetch" href="/assets/js/173.538a14c3.js"><link rel="prefetch" href="/assets/js/174.deb630d7.js"><link rel="prefetch" href="/assets/js/175.72af7d01.js"><link rel="prefetch" href="/assets/js/176.ba06ad7c.js"><link rel="prefetch" href="/assets/js/18.3afa24ca.js"><link rel="prefetch" href="/assets/js/19.ddba3727.js"><link rel="prefetch" href="/assets/js/20.91af6434.js"><link rel="prefetch" href="/assets/js/21.18968b63.js"><link rel="prefetch" href="/assets/js/22.65a90243.js"><link rel="prefetch" href="/assets/js/23.5f72be9f.js"><link rel="prefetch" href="/assets/js/24.6771af23.js"><link rel="prefetch" href="/assets/js/25.027ae10a.js"><link rel="prefetch" href="/assets/js/26.cd6e21b0.js"><link rel="prefetch" href="/assets/js/27.fcd0a0f1.js"><link rel="prefetch" href="/assets/js/28.423173ee.js"><link rel="prefetch" href="/assets/js/29.48a88cf4.js"><link rel="prefetch" href="/assets/js/3.0f3b3e4d.js"><link rel="prefetch" href="/assets/js/30.2484da58.js"><link rel="prefetch" href="/assets/js/31.26de4795.js"><link rel="prefetch" href="/assets/js/32.482992d7.js"><link rel="prefetch" href="/assets/js/33.d2c3c0a7.js"><link rel="prefetch" href="/assets/js/34.5224d1e9.js"><link rel="prefetch" href="/assets/js/35.4e7cd327.js"><link rel="prefetch" href="/assets/js/37.3f6e0726.js"><link rel="prefetch" href="/assets/js/38.03b0c1ec.js"><link rel="prefetch" href="/assets/js/39.681039b2.js"><link rel="prefetch" href="/assets/js/4.9f8ced62.js"><link rel="prefetch" href="/assets/js/40.abea8e3a.js"><link rel="prefetch" href="/assets/js/41.34be347d.js"><link rel="prefetch" href="/assets/js/42.f5af721f.js"><link rel="prefetch" href="/assets/js/43.16571ff8.js"><link rel="prefetch" href="/assets/js/44.456cb65e.js"><link rel="prefetch" href="/assets/js/45.9fe05289.js"><link rel="prefetch" href="/assets/js/46.f3f007f3.js"><link rel="prefetch" href="/assets/js/47.5406eb70.js"><link rel="prefetch" href="/assets/js/48.9ecdc4bd.js"><link rel="prefetch" href="/assets/js/49.98f93378.js"><link rel="prefetch" href="/assets/js/5.f5a5859e.js"><link rel="prefetch" href="/assets/js/50.9aa5f2f6.js"><link rel="prefetch" href="/assets/js/51.9cced2f2.js"><link rel="prefetch" href="/assets/js/52.3ae443d4.js"><link rel="prefetch" href="/assets/js/53.d7ccf15e.js"><link rel="prefetch" href="/assets/js/54.b690923e.js"><link rel="prefetch" href="/assets/js/55.a1f16a12.js"><link rel="prefetch" href="/assets/js/56.14b93433.js"><link rel="prefetch" href="/assets/js/57.a0f83ca8.js"><link rel="prefetch" href="/assets/js/58.30731a9c.js"><link rel="prefetch" href="/assets/js/59.2395bfc6.js"><link rel="prefetch" href="/assets/js/6.e9b450da.js"><link rel="prefetch" href="/assets/js/60.6b5b1b31.js"><link rel="prefetch" href="/assets/js/61.6eead5c2.js"><link rel="prefetch" href="/assets/js/62.adf8e39e.js"><link rel="prefetch" href="/assets/js/63.a27bd613.js"><link rel="prefetch" href="/assets/js/64.94dac151.js"><link rel="prefetch" href="/assets/js/65.09b09746.js"><link rel="prefetch" href="/assets/js/66.51a4f648.js"><link rel="prefetch" href="/assets/js/67.ad4d01cb.js"><link rel="prefetch" href="/assets/js/68.f2260ba6.js"><link rel="prefetch" href="/assets/js/69.689747a3.js"><link rel="prefetch" href="/assets/js/7.09fe4966.js"><link rel="prefetch" href="/assets/js/70.e0c73a22.js"><link rel="prefetch" href="/assets/js/71.7fea112a.js"><link rel="prefetch" href="/assets/js/72.f041b008.js"><link rel="prefetch" href="/assets/js/73.fea5a024.js"><link rel="prefetch" href="/assets/js/74.0f87be33.js"><link rel="prefetch" href="/assets/js/75.e8fd2a19.js"><link rel="prefetch" href="/assets/js/76.cbae0e4b.js"><link rel="prefetch" href="/assets/js/77.5383c235.js"><link rel="prefetch" href="/assets/js/78.f6192123.js"><link rel="prefetch" href="/assets/js/79.49003bd1.js"><link rel="prefetch" href="/assets/js/8.0c82c132.js"><link rel="prefetch" href="/assets/js/80.11d69d10.js"><link rel="prefetch" href="/assets/js/81.3f204432.js"><link rel="prefetch" href="/assets/js/82.c03c5548.js"><link rel="prefetch" href="/assets/js/83.b24468bb.js"><link rel="prefetch" href="/assets/js/84.aeb945dd.js"><link rel="prefetch" href="/assets/js/85.9ea8a4ed.js"><link rel="prefetch" href="/assets/js/86.f7c226d3.js"><link rel="prefetch" href="/assets/js/87.1b3a548f.js"><link rel="prefetch" href="/assets/js/88.9a54dbc6.js"><link rel="prefetch" href="/assets/js/89.2f907505.js"><link rel="prefetch" href="/assets/js/9.81357d9e.js"><link rel="prefetch" href="/assets/js/90.03530653.js"><link rel="prefetch" href="/assets/js/91.27822bbf.js"><link rel="prefetch" href="/assets/js/92.613514fb.js"><link rel="prefetch" href="/assets/js/93.e06e0e69.js"><link rel="prefetch" href="/assets/js/94.c4a392f0.js"><link rel="prefetch" href="/assets/js/95.a80003aa.js"><link rel="prefetch" href="/assets/js/96.ac6481f9.js"><link rel="prefetch" href="/assets/js/97.305dfef5.js"><link rel="prefetch" href="/assets/js/98.ce4f0bd3.js"><link rel="prefetch" href="/assets/js/99.831c25bb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e53c6d82.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.jpg" alt="Ryan Lin 的知识库" class="logo"> <span class="site-name can-hide">Ryan Lin 的知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>HTML</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/html/overview.html" class="sidebar-link">概览</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Typescript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NodeJs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>动画</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>脚手架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>同构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>serverless</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>跨端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>移动端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>桌面端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Monorepo</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Chrome</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>引擎</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DevOps</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>流程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>灰度</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>监控</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>部署</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>发布</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>调试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>测试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>编程范式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/design-patterns/origin" class="sidebar-heading clickable"><span>设计模式</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>操作系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构与算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>文档管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>C++</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中国近代史纲要</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>马克思主义基本原理概述</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="设计模式"><a href="#设计模式" class="header-anchor">#</a> 设计模式</h1> <p>设计原则通常指的是：</p> <p>** 单一职责原则 **</p> <p>** 里氏替换原则 **</p> <p>** 依赖倒置原则 **</p> <p>** 接口隔离原则 **</p> <p>** 合成复用原则 **</p> <p>** 最少知识原则 **</p> <h2 id="单一职责原则"><a href="#单一职责原则" class="header-anchor">#</a> 单一职责原则</h2> <p>就一个类而言，应该仅有一个引起它变化的原因。在 JavaScript 中，需要用到类的场景并不太多，
单一职责原则更多地是被运用在对象或者方法级别上，因此本节我们的讨论大多基于对象 和方法。</p> <p>单一职责原则(SRP)的职责被定义为“引起变化的原因”。如果我们有两个动机去改写一个方法，那么这个方法就具有两个职责。
每个职责都是变化的一个轴线，如果一个方法承担了过多的职责，那么在需求的变迁过程中，需要改写这个方法的可能性就越大。</p> <p>此时，这个方法通常是一个不稳定的方法，修改代码总是一件危险的事情，特别是当两个职责耦合在一起的时候，
一个职责发生变化可能会影响到其他职责的实现，造成意想不到的破坏， 这种耦合性得到的是低内聚和脆弱的设计。
因此，SRP 原则体现为: ** 一个对象(方法)只做一件事情 **</p> <h3 id="设计模式中的-srp-原则"><a href="#设计模式中的-srp-原则" class="header-anchor">#</a> 设计模式中的 SRP 原则</h3> <p>SRP 原则在很多设计模式中都有着广泛的运用，例如代理模式、迭代器模式、单例模式和装饰者模式。</p> <ul><li><ol><li>代理模式</li></ol></li></ul> <p>通过增加虚拟代理的方式，把预加载图片的职责放到代理对象中，而本体仅仅负责往页面中添加 img 标签，这也是它最原始的职责。</p> <p>myImage 负责往页面中添加 img 标签:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">var</span> myImage <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> imgNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>imgNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">setSrc</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        imgNode<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>proxyImage 负责预加载图片，并在预加载完成之后把请求交给本体 myImage:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">var</span> proxyImage <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      myImage<span class="token punctuation">.</span><span class="token function">setSrc</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">setSrc</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        myImage<span class="token punctuation">.</span><span class="token function">setSrc</span><span class="token punctuation">(</span><span class="token string">&quot;file:// /C:/Users/svenzeng/Desktop/loading.gif&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        img<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  proxyImage<span class="token punctuation">.</span><span class="token function">setSrc</span><span class="token punctuation">(</span>
    <span class="token string">&quot;http:// imgcache.qq.com/music/photo/000GGDys0yA0Nk.jpg&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>把添加 img 标签的功能和预加载图片的职责分开放到两个对象中，这两个对象各自都只有一
个被修改的动机。在它们各自发生改变的时候，也不会影响另外的对象。</p> <ul><li><ol start="2"><li>迭代器模式</li></ol></li></ul> <p>我们有这样一段代码，先遍历一个集合，然后往页面中添加一些 div，这些 div 的 innerHTML分别对应集合里的元素:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">var</span> <span class="token function-variable function">appendDiv</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">appendDiv</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这其实是一段很常见的代码，经常用于 ajax 请求之后，在回调函数中遍历 ajax 请求返回的 数据，然后在页面中渲染节点。</p> <p>appendDiv 函数本来只是负责渲染数据，但是在这里它还承担了遍历聚合对象 data 的职责。
我们想象一下，如果有一天返回的 data 数据格式从 array 变成了 object，那我们遍历 data 的 代码就会出现问题，
必须改成 for ( var i in data )的方式，这时候必须去修改 appendDiv 里的代码，
否则因为遍历方式的改变，导致不能顺利往页面中添加 div 节点。</p> <p>我们有必要把遍历 data 的职责提取出来，这正是迭代器模式的意义，
迭代器模式提供了一 种方法来访问聚合对象，而不用暴露这个对象的内部表示。</p> <p>当把迭代聚合对象的职责单独封装在 each 函数中后，即使以后还要增加新的迭代方式，我
们只需要修改 each 函数即可，appendDiv 函数不会受到牵连，代码如下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">var</span> <span class="token function-variable function">each</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> value<span class="token punctuation">,</span>
      i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
      length <span class="token operator">=</span> obj<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
      isArray <span class="token operator">=</span> <span class="token function">isArraylike</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isArray<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 迭代类数组</span>

      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// isArraylike 函数未实现，可以翻阅 jQuery 源代码</span>
        <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 迭代object对象</span>
        value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> <span class="token function-variable function">appendDiv</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">each</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> n<span class="token punctuation">;</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">appendDiv</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">appendDiv</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> d<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ul><li><ol start="3"><li>单例模式</li></ol></li></ul> <p>曾实现过一个惰性单例，最开始的代码是这样的:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">var</span> createLoginLayer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> div<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>div<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;我是登录浮窗&quot;</span><span class="token punctuation">;</span>
        div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> div<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>现在我们把管理单例的职责和创建登录浮窗的职责分别封装在两个方法里，这两个方法可以独立变化而互不影响，
当它们连接在一起的时候，就完成了创建唯一登录浮窗的功能，下面的代码显然是更好的做法:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">var</span> <span class="token function-variable function">getSingle</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取单例 var result;</span>

    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> result <span class="token operator">||</span> <span class="token punctuation">(</span>result <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">createLoginLayer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 创建登录浮窗</span>
    <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;我是登录浮窗&quot;</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> div<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> createSingleLoginLayer <span class="token operator">=</span> <span class="token function">getSingle</span><span class="token punctuation">(</span>createLoginLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> loginLayer1 <span class="token operator">=</span> <span class="token function">createSingleLoginLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> loginLayer2 <span class="token operator">=</span> <span class="token function">createSingleLoginLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>loginLayer1 <span class="token operator">===</span> loginLayer2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li><ol start="4"><li>装饰者模式</li></ol></li></ul> <p>使用装饰者模式的时候，我们通常让类或者对象一开始只具有一些基础的职责，更多的职责在代码运行时被动态装饰到对象上面。
装饰者模式可以为对象动态增加职责，从另一个角度来看， 这也是分离职责的一种方式。</p> <p>我们把数据上报的功能单独放在一个函数里，然后把这个函 数动态装饰到业务函数上面:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">after</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">afterfn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> __self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token function">__self</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">afterfn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> <span class="token function-variable function">showLogin</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;打开登录浮层&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> <span class="token function-variable function">log</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;上报标签为: &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;tag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> showLogin<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="何时应该分离职责"><a href="#何时应该分离职责" class="header-anchor">#</a> 何时应该分离职责</h3> <p>SRP 原则是所有原则中最简单也是最难正确运用的原则之一。</p> <p>要明确的是，并不是所有的职责都应该一一分离。</p> <p>一方面，如果随着需求的变化，有两个职责总是同时变化，那就不必分离他们。比如在 ajax 请求的时候，
创建 xhr 对象和发送 xhr 请求几乎总是在一起的，那么创建 xhr 对象的职责和发送 xhr 请求的职责就没有必要分开。</p> <p>另一方面，职责的变化轴线仅当它们确定会发生变化时才具有意义，即使两个职责已经被耦合在一起，
但它们还没有发生改变的征兆，那么也许没有必要主动分离它们，在代码需要重构的 时候再进行分离也不迟。</p> <h3 id="违反srp原则"><a href="#违反srp原则" class="header-anchor">#</a> 违反SRP原则</h3> <p>在人的常规思维中，总是习惯性地把一组相关的行为放到一起，如何正确地分离职责不是一件容易的事情。
我们也许从来没有考虑过如何分离职责，但这并不妨碍我们编写代码完成需求。
对于 SRP原则，许多专家委婉地表示“This is sometimes hard to see.”。</p> <p>一方面，我们受设计原则的指导，另一方面，我们未必要在任何时候都一成不变地遵守原则。
在实际开发中，因为种种原因违反 SRP 的情况并不少见。比如 jQuery 的 attr 等方法，就是明显 违反 SRP 原则的做法。
jQuery 的 attr 是个非常庞大的方法，既负责赋值，又负责取值，这对于 jQuery 的维护者来说，会带来一些困难，
但对于 jQuery 的用户来说，却简化了用户的使用。</p> <p>在方便性与稳定性之间要有一些取舍。具体是选择方便性还是稳定性，并没有标准答案，而是要取决于具体的应用环境。</p> <h3 id="srp-原则的优缺点"><a href="#srp-原则的优缺点" class="header-anchor">#</a> SRP 原则的优缺点</h3> <p>SRP 原则的优点是降低了单个类或者对象的复杂度，按照职责把对象分解成更小的粒度，
这有助于代码的复用，也有利于进行单元测试。当一个职责需要变更的时候，不会影响到其他的职责。</p> <p>但 SRP 原则也有一些缺点，最明显的是会增加编写代码的复杂度。当我们按照职责把对象分解成更小的粒度之后，
实际上也增大了这些对象之间相互联系的难度。</p> <h2 id="最少知识原则"><a href="#最少知识原则" class="header-anchor">#</a> 最少知识原则</h2> <p>最少知识原则(LKP)说的是一个软件实体应当尽可能少地与其他实体发生相互作用。
这里的软件实体是一个广义的概念，不仅包括对象，还包括系统、类、模块、函数、变量等。
本节我们主要针对对象来说明这个原则，下面引用《面向对象设计原理与模式》一书中的例子来解释最少知识原则:</p> <blockquote><p>某军队中的将军需要挖掘一些散兵坑。下面是完成任务的一种方式:将军可以通知 上校让他叫来少校，
然后让少校找来上尉，并让上尉通知一个军士，最后军士唤来一个士兵，然后命令士兵挖掘一些散兵坑。</p></blockquote> <p>这种方式十分荒谬，不是吗?不过，我们还是先来看一下这个过程的等价代码:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  gerneral<span class="token punctuation">.</span><span class="token function">getColonel</span><span class="token punctuation">(</span> c <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMajor</span><span class="token punctuation">(</span> m <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCaptain</span><span class="token punctuation">(</span> c <span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token function">getSergeant</span><span class="token punctuation">(</span> s <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span> p <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digFoxhole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>让代码通过这么长的消息链才能完成一个任务，这就像让将军通过那么多繁琐的步骤才能命令别人挖掘散兵坑一样荒谬!
而且，这条链中任何一个对象的改动都会影响整条链的结果。</p> <p>最有可能的是，将军自己根本就不会考虑挖散兵坑这样的细节信息。
但是如果将军真的考虑了这个问题的话，他一定会通知某个军官:“我不关心这个工作如何完成，但是你得命令人去挖散兵坑。”</p> <h3 id="减少对象之间的联系"><a href="#减少对象之间的联系" class="header-anchor">#</a> 减少对象之间的联系</h3> <p>单一职责原则指导我们把对象划分成较小的粒度，这可以提高对象的可复用性。
但越来越多的对象之间可能会产生错综复杂的联系，如果修改了其中一个对象，很可能会影响到跟它相互引用的其他对象。
对象和对象耦合在一起，有可能会降低它们的可复用性。
在程序中，对象的“朋友”太多并不是一件好事，“城门失火，殃及池鱼”和“一人犯法，株连九族”的故事 时有发生。</p> <p>最少知识原则要求我们在设计程序时，应当尽量减少对象之间的交互。如果两个对象之间不必彼此直接通信，那么这两个对象就不要发生直接的相互联系。
常见的做法是引入一个第三者对象，来承担这些对象之间的通信作用。如果一些对象需要向另一些对象发起请求，可以通过第三者对象来转发这些请求。</p> <h2 id="设计模式中的最少知识原则"><a href="#设计模式中的最少知识原则" class="header-anchor">#</a> 设计模式中的最少知识原则</h2> <p>最少知识原则在设计模式中体现得最多的地方是中介者模式和外观模式，下面我们分别进行介绍。</p> <h3 id="_1-中介者模式"><a href="#_1-中介者模式" class="header-anchor">#</a> 1. 中介者模式</h3> <p>在世界杯期间购买足球彩票，如果没有博彩公司作为中介，上千万的人一起计算赔率和输赢绝对是不可能的事情。
博彩公司作为中介，每个人都只和博彩公司发生关联，博彩公司会根据所有人的投注情况计算好赔率，
彩民们赢了钱就从博彩公司拿，输了钱就赔给博彩公司。</p> <p>中介者模式很好地体现了最少知识原则。通过增加一个中介者对象，让所有的相关对象都通 过中介者对象来通信，而不是互相引用。
所以，当一个对象发生改变时，只需要通知中介者对象即可。</p> <h3 id="_2-外观模式"><a href="#_2-外观模式" class="header-anchor">#</a> 2.外观模式</h3> <p>我们在第二部分没有提到外观模式，是因为外观模式在 JavaScript 中的使用场景并不多。
外观模式主要是为子系统中的一组接口提供一个一致的界面，外观模式定义了一个高层接口，这个 接口使子系统更加容易使用。</p> <p>外观模式的作用是对客户屏蔽一组子系统的复杂性。外观模式对客户提供一个简单易用的高层接口，
高层接口会把客户的请求转发给子系统来完成具体的功能实现。大多数客户都可以通过 请求外观接口来达到访问子系统的目的。
但在一段使用了外观模式的程序中，请求外观并不是强制的。如果外观不能满足客户的个性化需求，那么客户也可以选择越过外观来直接访问子系统。</p> <p>拿全自动洗衣机的一键洗衣按钮举例，这个一键洗衣按钮就是一个外观。如果是老式洗衣机， 客户要手动选择浸泡、洗衣、漂洗、脱水这 4 个步骤。
如果这种洗衣机被淘汰了，新式洗衣机的 漂洗方式发生了改变，那我们还得学习新的漂洗方式。
而全自动洗衣机的好处很明显，不管洗衣 机内部如何进化，客户要操作的，始终只是一个一键洗衣的按钮。
这个按钮就是为一组子系统所 创建的外观。但如果一键洗衣程序设定的默认漂洗时间是 20 分钟，
而客户希望这个漂洗时间是 30 分钟，那么客户自然可以选择越过一键洗衣程序，自己手动来控制这些“子系统”运转。</p> <p>外观模式容易跟普通的封装实现混淆。这两者都封装了一些事物，但外观模式的关键是定义一个高层接口去封装一组“子系统”。
子系统在 C++或者 Java 中指的是一组类的集合，这些类相互协作可以组成系统中一个相对独立的部分。
在 JavaScript 中我们通常不会过多地考虑“类”，如 果将外观模式映射到 JavaScript 中，这个子系统至少应该指的是一组函数的集合。</p> <p>最简单的外观模式应该是类似下面的代码:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">var</span> <span class="token function-variable function">A</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">a1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">a2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> <span class="token function-variable function">B</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">b1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">b2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> <span class="token function-variable function">facade</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">facade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>许多 JavaScript 设计模式的图书或者文章喜欢把 jQuery 的$.ajax 函数当作外观模式的实现， 这是不合适的。
如果$.ajax 函数属于外观模式，那几乎所有的函数都可以被称为“外观模式”。
问题是我们根本没有办法越过$.ajax“外观”去直接使用该函数中的某一段语句。</p> <p>假设我们要编写一个具有缓存效果的计算乘积的函数 function mult (){}，我们需要一个对象 var cache = {}来保存已经计算过的结果。
cache 对象显然只对 mult 有用，把 cache 对象放在现在再来看看外观模式和最少知识原则之间的关系。
外观模式的作用主要有两点。</p> <ul><li>为一组子系统提供一个简单便利的访问入口。</li> <li>隔离客户与复杂子系统之间的联系，客户不用去了解子系统的细节。</li></ul> <p>从第二点来，外观模式是符合最少知识原则的。比如全自动洗衣机的一键洗衣按钮，隔开了客户和浸泡、洗衣、漂洗、脱水这些子系统的直接联系，
客户不用去了解这些子系统的具体实现。</p> <p>假设我们在编写这个老式洗衣机的程序，客户至少要和浸泡、洗衣、漂洗、脱水这 4 个子系统打交道。
如果其中的一个子系统发生了改变，那么客户的调用代码就得发生改变。而通过外观将客户和这些子系统隔开之后，
如果修改子系统内部，只要外观不变，就不会影响客户的调用。 同样，对外观的修改也不会影响到子系统，它们可以分别变化而互不影响。</p> <h3 id="封装在最少知识原则中的体现"><a href="#封装在最少知识原则中的体现" class="header-anchor">#</a> 封装在最少知识原则中的体现</h3> <p>封装在很大程度上表达的是数据的隐藏。一个模块或者对象可以将内部的数据或者实现细节隐藏起来，只暴露必要的接口 API 供外界访问。
对象之间难免产生联系，当一个对象必须引用另外一个对象的时候，我们可以让对象只暴露必要的接口，让对象之间的联系限制在最小的范围之内。</p> <p>同时，封装也用来限制变量的作用域。在 JavaScript 中对变量作用域的规定是:</p> <p> 变量在全局声明，或者在代码的任何位置隐式申明(不用 var)，则该变量在全局可见;
 变量在函数内显式申明(使用 var)，则在函数内可见。</p> <p>把变量的可见性限制在一个尽可能小的范围内，这个变量对其他不相关模块的影响就越小，
变量被改写和发生冲突的机会也越小。这也是广义的最少知识原则的一种体现。</p> <p>假设我们要编写一个具有缓存效果的计算乘积的函数 function mult (){}，我们需要一个对象 var cache = {}来保存已经计算过的结果。
cache 对象显然只对 mult 有用，把 cache 对象放在mult 形成的闭包中，显然比把它放在全局作用域更加合适，代码如下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">var</span> mult <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>args<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> cache<span class="token punctuation">[</span>args<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>vari <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        a <span class="token operator">=</span> a <span class="token operator">*</span> arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>args<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">mult</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: 6</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>其实，最少知识原则也叫迪米特法则(Law of Demeter，LoD)，“迪米特”这个名字源自 1987 年美国东北大学一个名为“Demeter”的研究项目。
许多人更倾向于使用迪米特法则这个名字，也许是因为显得更酷一点。
但本书参考 Head First Design Patterns 的建议，称之为最少知识原则。
一是因为这个名字更能体现其含义，另一个原因 是“法则”给人的感觉是必须强制遵守，
而原则只是一种指导，没有哪条原则是在实际开发中必须遵守的。</p> <p>比如，虽然遵守最小知识原则减少了对象之间的依赖，但也有可能增加一些庞大到难以维护的第三者对象。
跟单一职责原则一样，在实际开发中，是否选择让代码符合最少知识原则， 要根据具体的环境来定。</p> <h2 id="开放-封闭原则"><a href="#开放-封闭原则" class="header-anchor">#</a> 开放-封闭原则</h2> <p>在面向对象的程序设计中，开放-封闭原则(OCP)是最重要的一条原则。
很多时候，一个程序具有良好的设计，往往说明它是符合开放封闭原则的。</p> <p>开放-封闭原则最早由 Eiffel 语言的设计者 Bertrand Meyer 在其著作 Object-Oriented Software Construction 中提出。
它的定义如下:</p> <blockquote><p>软件实体(类、模块、函数)等应该是可以扩展的，但是不可修改。</p></blockquote> <h3 id="扩展window-onload函数"><a href="#扩展window-onload函数" class="header-anchor">#</a> 扩展window.onload函数</h3> <p>假设我们是一个大型 Web 项目的维护人员，在接手这个项目时，发现它已经拥有 10 万行以上的 JavaScript 代码和数百个 JS 文件。</p> <p>不久后接到了一个新的需求，即在 window.onload 函数中打印出页面中的所有节点数量。这 当然难不倒我们了。
于是我们打开文本编辑器，搜索出 window.onload 函数在文件中的位置，在函数内部添加以下代码:</p> <p>在项目需求变迁的过程中，我们经常会找到相关代码，然后改写它们。这似乎是理所当然的事情，不改动代码怎么满足新的需求呢?
想要扩展一个模块，最常用的方式当然是修改它的源代 码。如果一个模块不允许修改，那么它的行为常常是固定的。
然而，改动代码是一种危险的行为， 也许我们都遇到过 bug 越改越多的场景。刚刚改好了一个 bug，但是又在不知不觉中引发了其他的 bug。</p> <p>如果目前的 window.onload 函数是一个拥有 500 行代码的巨型函数，里面密布着各种变量和 交叉的业务逻辑，
而我们的需求又不仅仅是打印一个 log 这么简单。那么“改好一个 bug，引发 其他 bug”这样的事情就很可能会发生。
我们永远不知道刚刚的改动会有什么副作用，很可能会 引发一系列的连锁反应。</p> <p>那么，有没有办法在不修改代码的情况下，就能满足新需求呢? 通过增加代码，而不是修改代码的方式，
来给 window.onload 函数添加新的功能，代码如下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">after</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">afterfn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> __self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token function">__self</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">afterfn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>onload <span class="token operator">||</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>通过动态装饰函数的方式，我们完全不用理会从前 window.onload 函数的内部实现，无论它的实现优雅或是丑陋。
就算我们作为维护者，拿到的是一份混淆压缩过的代码也没有关系。
只要它从前是个稳定运行的函数，那么以后也不会因为我们的新增需求而产生错误。新增的代码和原有的代码可以井水不犯河水。</p> <h3 id="开放和封闭"><a href="#开放和封闭" class="header-anchor">#</a> 开放和封闭</h3> <p>上一节为 window.onload 函数扩展功能时，用到了两种方式。一种是修改原有的代码，另一
种是增加一段新的代码。使用哪种方式效果更好，已经不言而喻。</p> <p>现在可以引出开放封闭原则的思想:</p> <p>** 当需要改变一个程序的功能或者给这个程序增加新功 能的时候，可以使用增加代码的方式，但是不允许改动程序的源代码 **</p> <p>在现实生活中，我们也能找到一些跟开放封闭原则相关的故事。下面这个故事人尽皆知， 且跟肥皂相关。</p> <blockquote><p>有一家生产肥皂的大企业，从欧洲花巨资引入了一条生产线。
这条生产线可以自动 完成从原材料加工到包装成箱的整个流程，但美中不足的是，生产出来的肥皂有一定的空盒几率。
于是老板又从欧洲找来一支专家团队，花费数百万元改造这一生产线，终于 解决了生产出空盒肥皂的问题。</p></blockquote> <blockquote><p>另一家企业也引入了这条生产线，他们同样遇到了空盒肥皂的问题。但他们的解决
办法很简单:用一个大风扇在生产线旁边吹，空盒肥皂就会被吹走。</p></blockquote> <p>这个故事告诉我们，相比修改源程序，如果通过增加几行代码就能解决问题，那这显然更加简单和优雅，而且增加代码并不会影响原系统的稳定。
讲述这个故事，我们的目的不在于说明风扇的成本有多低，而是想说明，如果使用风扇这样简单的方式可以解决问题，
根本没有必要去大动干戈地改造原有的生产线。</p> <h3 id="用对象的多态性消除条件分支"><a href="#用对象的多态性消除条件分支" class="header-anchor">#</a> 用对象的多态性消除条件分支</h3> <p>过多的条件分支语句是造成程序违反开放封闭原则的一个常见原因。每当需要增加一个新 的 if 语句时，都要被迫改动原函数。
把 if 换成 switch-case 是没有用的，这是一种换汤不换药的做法。
实际上，每当我们看到一大片的 if 或者 swtich-case 语句时，第一时间就应该考虑，能 否利用对象的多态性来重构它们。</p> <p>利用对象的多态性来让程序遵守开放封闭原则，是一个常用的技巧。我们选用让动物发出叫声的例子。
下面先提供一段不符合开放封闭原则的代码。每当我们增加一种新的动物时，都需要改动 makeSound 函数的内部实现:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">var</span> <span class="token function-variable function">makeSound</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">animal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>animal <span class="token keyword">instanceof</span> <span class="token class-name">Duck</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;嘎嘎嘎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>animal <span class="token keyword">instanceof</span> <span class="token class-name">Chicken</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;咯咯咯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">Duck</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> <span class="token function-variable function">Chicken</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Duck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Chicken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>动物世界里增加一只狗之后，makeSound 函数必须改成:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">var</span> <span class="token function-variable function">makeSound</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">animal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>animal <span class="token keyword">instanceof</span> <span class="token class-name">Duck</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;嘎嘎嘎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>animal <span class="token keyword">instanceof</span> <span class="token class-name">Chicken</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;咯咯咯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>animal <span class="token keyword">instanceof</span> <span class="token class-name">Dog</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;汪汪汪&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token keyword">var</span> <span class="token function-variable function">Dog</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 增加一只狗</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>利用多态的思想，我们把程序中不变的部分隔离出来(动物都会叫)，
然后把可变的部分封 装起来(不同类型的动物发出不同的叫声)，这样一来程序就具有了可扩展性。
当我们想让一只狗发出叫声时，只需增加一段代码即可，而不用去改动原有的 makeSound 函数:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">var</span> <span class="token function-variable function">makeSound</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">animal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    animal<span class="token punctuation">.</span><span class="token function">sound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">Duck</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token class-name">Duck</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sound</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;嘎嘎嘎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">Chicken</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token class-name">Chicken</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sound</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;咯咯咯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Duck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 嘎嘎嘎</span>
  <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Chicken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 咯咯咯</span>

  <span class="token comment">/********* 增加动物狗，不用改动原有的 makeSound 函数 ****************/</span>
  <span class="token keyword">var</span> <span class="token function-variable function">Dog</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token class-name">Dog</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sound</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;汪汪汪&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 汪汪汪</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="找出变化的地方"><a href="#找出变化的地方" class="header-anchor">#</a> 找出变化的地方</h3> <p>开放封闭原则是一个看起来比较虚幻的原则，并没有实际的模板教导我们怎样亦步亦趋地实现它。
但我们还是能找到一些让程序尽量遵守开放封闭原则的规律，最明显的就是找出程序中将要发生变化的地方，然后把变化封装起来。</p> <p>通过封装变化的方式，可以把系统中稳定不变的部分和容易变化的部分隔离开来。在系统的演变过程中，我们只需要替换那些容易变化的部分，
如果这些部分是已经被封装好的，那么替换 起来也相对容易。而变化部分之外的就是稳定的部分。在系统的演变过程中，稳定的部分是不需要改变的。
在上一节的例子中，由于每种动物的叫声都不同，所以动物具体怎么叫是可变的，于是我们 把动物具体怎么叫的逻辑从 makeSound 函数中分离出来。</p> <p>而动物都会叫这是不变的，makeSound 函数里的实现逻辑只跟动物都会叫有关，这样一来，makeSound 就成了一个稳定和封闭的函数。
除了利用对象的多态性之外，还有其他方式可以帮助我们编写遵守开放封闭原则的代码，下面将详细介绍。</p> <ul><li>1、放置挂钩</li></ul> <p>放置挂钩(hook)也是分离变化的一种方式。我们在程序有可能发生变化的地方放置一个挂钩，挂钩的返回结果决定了程序的下一步走向。
这样一来，原本的代码执行路径上就出现了一个分叉路口，程序未来的执行方向被预埋下多种可能性。</p> <p>翻阅过 jQuery 源代码的读者也许会留意，jQuery 从 1.4 版本开始，陆续加入了 fixHooks、 keyHooks、mouseHooks、cssHooks 等挂钩。
在 Template  模式已经见过了 hook了， 在其中的父类是一个相当稳定的类，它封装了子类的算法骨架和执行步骤。</p> <p>由于子类的数量是无限制的，总会有一些“个性化”的子类迫使我们不得不去改变已经封装好的算法骨架。
于是我们可以在父类中的某个容易变化的地方放置挂钩，挂钩的返回结果由具体 子类决定。这样一来，程序就拥有了变化的可能。</p> <ul><li>2、 使用回调函数</li></ul> <p>在 JavaScript 中，函数可以作为参数传递给另外一个函数，这是高阶函数的意义之一。在这种情况下，我们通常会把这个函数称为回调函数。
在 JavaScript 版本的设计模式中，策略模式和 命令模式等都可以用回调函数轻松实现。</p> <p>回调函数是一种特殊的挂钩。我们可以把一部分易于变化的逻辑封装在回调函数里，然后把回调函数当作参数传入一个稳定和封闭的函数中。
当回调函数被执行的时候，程序就可以因为回 调函数的内部逻辑不同，而产生不同的结果。</p> <p>比如，我们通过 ajax 异步请求用户信息之后要做一些事情，请求用户信息的过程是不变的， 而获取到用户信息之后要做什么事情，则是可能变化的:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">var</span> <span class="token function-variable function">getUserInfo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">&quot;http:// xxx.com/getUserInfo&quot;</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>另外一个例子是关于 Array.prototype.map 的。在不支持 Array.prototype.map 的浏览器中，我们可以简单地模拟实现一个 map 函数。</p> <p>arrayMap 函数的作用是把一个数组“映射”为另外一个数组。
映射的步骤是不变的，而映射的规则是可变的，于是我们把这部分规则放在回调函数中，传入 arrayMap 函数:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">var</span> <span class="token function-variable function">arrayMap</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ary<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
      length <span class="token operator">=</span> ary<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
      value<span class="token punctuation">,</span>
      ret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> ary<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ret<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">arrayMap</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">arrayMap</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出:[ 2, 4, 6 ]</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出:[ 3, 6, 9 ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="设计模式中的开放-封闭原则"><a href="#设计模式中的开放-封闭原则" class="header-anchor">#</a> 设计模式中的开放-封闭原则</h3> <ul><li><ol><li>发布订阅模式</li></ol></li></ul> <p>发布-订阅模式用来降低多个对象之间的依赖关系，它可以取代对象之间硬编码的通知机制， 一个对象不用再显式地调用另外一个对象的某个接口。
当有新的订阅者出现时，发布者的代码不 需要进行任何修改;同样当发布者需要改变时，也不会影响到之前的订阅者。</p> <ul><li><ol start="2"><li>模板方法模式</li></ol></li></ul> <p>模板方法模式是一种典型的通过封装变化来提高系统扩展性的设计模式。
在一个运用了模板方法模式的程序中，子类的方法种类和执行顺序都是不变的，所以 我们把这部分逻辑抽出来放到父类的模板方法里面;
而子类的方法具体怎么实现则是可变的，于是把这部分变化的逻辑封装到子类中。
通过增加新的子类，便能给系统增加新的功能，并不需要改动抽象父类以及其他的子类，这也是符合开放封闭原则的。</p> <ul><li><ol start="3"><li>策略模式</li></ol></li></ul> <p>策略模式和模板方法模式是一对竞争者。在大多数情况下，它们可以相互替换使用。
模板方法模式基于继承的思想，而策略模式则偏重于组合和委托。
策略模式将各种算法都封装成单独的策略类，这些策略类可以被交换使用。
策略和使用策略的客户代码可以分别独立进行修改而互不影响。我们增加一个新的策略类也非常方便，完全不用修改之前的代码。</p> <ul><li><ol start="4"><li>代理模式</li></ol></li></ul> <p>拿预加载图片举例，我们现在已有一个给图片设置 src 的函数 myImage，
当我们想为它增加图片预加载功能时， 一种做法是改动 myImage 函数内部的代码，
更好的做法是提供一个代理函数 proxyMyImage，代理函数负责图片预加载，
在图片预加载完成之后，再将请求转交给原来的 myImage 函数，myImage 在 这个过程中不需要任何改动。</p> <p>预加载图片的功能和给图片设置 src 的功能被隔离在两个函数里，它们可以单独改变而互不影响。
myImage 不知晓代理的存在，它可以继续专注于自己的职责——给图片设置 src。</p> <ul><li><ol start="5"><li>职责链模式</li></ol></li></ul> <p>把一个巨大的订单函数分别拆成了 500 元订单、 200 元订单以及普通订单的 3 个函数。
这 3 个函数通过职责链连接在一起，客户的请求会在这条链条里面依次传递:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">var</span> order500yuan <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chain</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">orderType<span class="token punctuation">,</span> pay<span class="token punctuation">,</span> stock</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 具体代码略</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> order200yuan <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chain</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">orderType<span class="token punctuation">,</span> pay<span class="token punctuation">,</span> stock</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 具体代码略</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> orderNormal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chain</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">orderType<span class="token punctuation">,</span> pay<span class="token punctuation">,</span> stock</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 具体代码略</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  order500yuan<span class="token punctuation">.</span><span class="token function">setNextSuccessor</span><span class="token punctuation">(</span>order200yuan<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setNextSuccessor</span><span class="token punctuation">(</span>orderNormal<span class="token punctuation">)</span><span class="token punctuation">;</span>
  order500yuan<span class="token punctuation">.</span><span class="token function">passRequest</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 500 元定金预购，得到 100 优惠券</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>可以看到，当我们增加一个新类型的订单函数时，不需要改动原有的订单函数代码，只需要在链条中增加一个新的节点。</p> <h3 id="开放-封闭原则的相对性"><a href="#开放-封闭原则的相对性" class="header-anchor">#</a> 开放-封闭原则的相对性</h3> <p>在职责链模式代码中，大家也许会产生这个疑问: 开放封闭原则要求我们只能通过增加源 代码的方式扩展程序的功能，而不允许修改源代码。
那当我们往职责链中增加一个新的 100 元订 单函数节点时，不也必须改动设置链条的代码吗?代码如下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  order500yuan<span class="token punctuation">.</span><span class="token function">setNextSuccessor</span><span class="token punctuation">(</span>order200yuan<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setNextSuccessor</span><span class="token punctuation">(</span>orderNormal<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>变为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  order500yuan
        <span class="token punctuation">.</span><span class="token function">setNextSuccessor</span><span class="token punctuation">(</span>order200yuan<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setNextSuccessor</span><span class="token punctuation">(</span>order100yuan<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setNextSuccessor</span><span class="token punctuation">(</span>orderNormal<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>实际上，让程序保持完全封闭是不容易做到的。就算技术上做得到，也需要花费太多的时间 和精力。
而且让程序符合开放-封闭原则的代价是引入更多的抽象层次，更多的抽象有可能会增大代码的复杂度。</p> <p>更何况，有一些代码是无论如何也不能完全封闭的，总会存在一些无法对其封闭的变化。作 为程序员，我们可以做到的有下面两点。</p> <ul><li>挑选出最容易发生变化的地方，然后构造抽象来封闭这些变化。</li> <li>在不可避免发生修改的时候，尽量修改那些相对容易修改的地方。拿一个开源库来说，修改它提供的配置文件，总比修改它的源代码来得简单。</li></ul> <p>比如那个巨大的订单函数，它包含了各种订单的逻辑，有 500 元和 200 元的，也有普通订单的。
这个函数是最有可能发生变化的，一旦增加新的订单，就必须修改这个 巨大的函数。
而用职责链模式重构之后，我们只需要新增一个节点，然后重新设置链条中节点的 连接顺序。
重构后的修改方式显然更加清晰简单 。</p> <h3 id="接受第一次愚弄"><a href="#接受第一次愚弄" class="header-anchor">#</a> 接受第一次愚弄</h3> <p>下面这段话引自 Bob 大叔的《敏捷软件开发原则、模式与实践》。</p> <blockquote><p>有句古老的谚语说:“愚弄我一次，应该羞愧的是你。再次愚弄我，应该羞愧的是 我。
”这也是一种有效的对待软件设计的态度。为了防止软件背着不必要的复杂性，我们会允许自己被愚弄一次。</p></blockquote> <p>让程序一开始就尽量遵守开放封闭原则，并不是一件很容易的事情。
一方面，我们需要尽 快知道程序在哪些地方会发生变化，这要求我们有一些“未卜先知”的能力。
另一方面，留给程 序员的需求排期并不是无限的，所以我们可以说服自己去接受不合理的代码带来的第一次愚弄。
在最初编写代码的时候，先假设变化永远不会发生，这有利于我们迅速完成需求。
当变化发生并且对我们接下来的工作造成影响的时候，可以再回过头来封装这些变化的地方。
然后确保我们不会掉进同一个坑里，这有点像星矢说的:“圣斗士不会被同样的招数击倒第二次。”</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/26/2020, 2:00:22 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.5eb6871a.js" defer></script><script src="/assets/js/2.bffc4eaa.js" defer></script><script src="/assets/js/36.d28870aa.js" defer></script>
  </body>
</html>
